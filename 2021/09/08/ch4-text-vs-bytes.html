<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Chapter 4: Text versus Bytes | Fluent-Python Notes</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Chapter 4: Text versus Bytes" />
<meta name="author" content="JJmachan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="more about str and byte" />
<meta property="og:description" content="more about str and byte" />
<link rel="canonical" href="https://fluentpython.jjmachan.in/2021/09/08/ch4-text-vs-bytes.html" />
<meta property="og:url" content="https://fluentpython.jjmachan.in/2021/09/08/ch4-text-vs-bytes.html" />
<meta property="og:site_name" content="Fluent-Python Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-08T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://fluentpython.jjmachan.in/2021/09/08/ch4-text-vs-bytes.html","@type":"BlogPosting","headline":"Chapter 4: Text versus Bytes","dateModified":"2021-09-08T00:00:00-05:00","datePublished":"2021-09-08T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://fluentpython.jjmachan.in/2021/09/08/ch4-text-vs-bytes.html"},"author":{"@type":"Person","name":"JJmachan"},"description":"more about str and byte","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://fluentpython.jjmachan.in/feed.xml" title="Fluent-Python Notes" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176495138-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176495138-1');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Fluent-Python Notes</a></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Chapter 4: Text versus Bytes</h1><p class="page-description">more about str and byte</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-09-08T00:00:00-05:00" itemprop="datePublished">
        Sep 8, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">JJmachan</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/jjmachan/fluent-python/tree/master/_notebooks/2021-09-08-ch4-text-vs-bytes.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/jjmachan/fluent-python/blob/master/_notebooks/2021-09-08-ch4-text-vs-bytes.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Charecter-Issue">Charecter Issue </a></li>
<li class="toc-entry toc-h2"><a href="#Byte-Essentials">Byte Essentials </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Structs-and-Memory-Views">Structs and Memory Views </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Encoder/Decoder">Encoder/Decoder </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Problems-you-might-encounter">Problems you might encounter </a>
<ul>
<li class="toc-entry toc-h4"><a href="#UnicodeEncodeError">UnicodeEncodeError </a></li>
<li class="toc-entry toc-h4"><a href="#UnicodeDecodeError">UnicodeDecodeError </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#SyntaxError-when-loading-Modules-with-Unexpected-Encodings">SyntaxError when loading Modules with Unexpected Encodings </a></li>
<li class="toc-entry toc-h3"><a href="#How-to-Discover-the-Encoding-of-a-Byte-Sequence">How to Discover the Encoding of a Byte Sequence </a></li>
<li class="toc-entry toc-h3"><a href="#BOM:-A-Useful-Gremlin">BOM: A Useful Gremlin </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-09-08-ch4-text-vs-bytes.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Charecter-Issue">
<a class="anchor" href="#Charecter-Issue" aria-hidden="true"><span class="octicon octicon-link"></span></a>Charecter Issue<a class="anchor-link" href="#Charecter-Issue"> </a>
</h2>
<p>Now the best definition of what a Charater is, is its Unicode representation. The Unicode standard explicitly seperates the identity of charaters from its bytes representation.</p>
<p>The identity of the character is its code point (ie in the form U+000000). For example A is U+0041.</p>
<p>The actual bytes representation depends on the encoding that is used. If we use UTF-8 encoding, the byte representation of A is \x41 but if we use UTF-16LE it is \x41\x00</p>
<p><em>Coverting from code points to bytes is called <strong>encoding</strong> and from bytes to code points is called <strong>decoding</strong></em></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">'café'</span>
<span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>4</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf_8'</span><span class="p">)</span>
<span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'caf\xc3\xa9'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(5, 'café')</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Byte-Essentials">
<a class="anchor" href="#Byte-Essentials" aria-hidden="true"><span class="octicon octicon-link"></span></a>Byte Essentials<a class="anchor-link" href="#Byte-Essentials"> </a>
</h2>
<p>There are 2 basic build-in types for binary sequence, the immutable <code>bytes</code> type and the mutable <code>bytearray</code>. Each item in both is an integer from 0-255</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cafe</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s1">'café'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf_8'</span><span class="p">)</span>
<span class="n">cafe</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'caf\xc3\xa9'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">cafe</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cafe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>99</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cafe</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cafe</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>99
97
102
195
169
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cafe</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'c'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cafe_arr</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">cafe</span><span class="p">)</span>
<span class="n">cafe_arr</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>bytearray(b'caf\xc3\xa9')</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cafe_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>bytearray(b'\xa9')</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">cafe_arr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, even though the binary sequence is sequence of integers, they are displayed on each byte value. ASCII text and espace squences are displayed as its is while all other bytes use a hexadecimal escape sequence.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Both bytes and bytearray support every str method except those that do formatting
( format , format_map ) and a few others that depend on Unicode data, including case
fold , isdecimal , isidentifier , isnumeric , isprintable , and encode . This means that
you can use familiar string methods like endswith , replace , strip , translate , upper ,
and dozens of others with binary sequences—only using bytes and not str arguments.
In addition, the regular expression functions in the re module also work on binary
sequences, if the regex is compiled from a binary sequence instead of a str .</p>
<p>A <code>byte</code> or <code>bytearray</code> can be build in many ways like</p>
<ol>
<li>using the constructors calling classmethods like <code>byte.fromhex()</code>
</li>
<li>A <code>str</code> and an <code>encoding</code> keyword argument.</li>
<li>An iterable providing items with values from 0 to 255.</li>
<li>An object that implements the buffer protocol (e.g., bytes, bytearray, memory
view, array.array); this copies the bytes from the source object to the newly created binary sequence.</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">'31 4B CE A9'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># from an object that implements the buffer protocol</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="c1"># 'h' denotes short integers</span>
<span class="n">nums</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">'h'</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">octets</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span>

<span class="c1"># from iterable</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>b'1K\xce\xa9'
b'\xfe\xff\xff\xff\x00\x00\x01\x00\x02\x00'
b'ABC'
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Creating bytes/bytearray from buffer like source will always copy the bytes. In contrast <code>memoryview</code> objects let you share memory between both. To extract structured information from the binary source use the <code>struct</code> module.</p>
<h3 id="Structs-and-Memory-Views">
<a class="anchor" href="#Structs-and-Memory-Views" aria-hidden="true"><span class="octicon octicon-link"></span></a>Structs and Memory Views<a class="anchor-link" href="#Structs-and-Memory-Views"> </a>
</h3>
<p>To show the power of struct and memoryview let see an example were we 
took at the header of a gif file.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">struct</span>
<span class="c1"># format of the bytes string (gif header)</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s1">'&lt;3s3sHH'</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'leo.gif'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">img</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    
<span class="n">header</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># creates a new memory view for only the headers</span>
<span class="nb">bytes</span><span class="p">(</span><span class="n">header</span><span class="p">),</span> <span class="n">header</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(b'GIF89aX\x02\x90\x01', &lt;memory at 0x7f4d9050c400&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(b'GIF', b'89a', 600, 400)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">header</span>
<span class="k">del</span> <span class="n">img</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Encoder/Decoder">
<a class="anchor" href="#Encoder/Decoder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Encoder/Decoder<a class="anchor-link" href="#Encoder/Decoder"> </a>
</h2>
<p>Pythons comes with 100s of basic encoders and decoder that are used to handle the different types commonly seen in the wild. Here is an example of a string encoded with 3 different codecs producing very different results.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">codec</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'latin_1'</span><span class="p">,</span> <span class="s1">'utf_8'</span><span class="p">,</span> <span class="s1">'utf_16'</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s1">'El Niño'</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">codec</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>latin_1	b'El Ni\xf1o'
utf_8	b'El Ni\xc3\xb1o'
utf_16	b'\xff\xfeE\x00l\x00 \x00N\x00i\x00\xf1\x00o\x00'
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Problems-you-might-encounter">
<a class="anchor" href="#Problems-you-might-encounter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Problems you might encounter<a class="anchor-link" href="#Problems-you-might-encounter"> </a>
</h3>
<p>Python throws a encoding or decoding error <code>UnicodeEnodeError</code> or <code>UnicodeDecodeError</code>. We will look into how to handle these. It can also raise a <code>SyntaxException</code> when the source encoding is unexpected.</p>
<h4 id="UnicodeEncodeError">
<a class="anchor" href="#UnicodeEncodeError" aria-hidden="true"><span class="octicon octicon-link"></span></a>UnicodeEncodeError<a class="anchor-link" href="#UnicodeEncodeError"> </a>
</h4>
<p>Most not-utf codecs only handle a small subset of chars. This error is raised when converting from text to bytes and a char is not supported by the codec.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">city</span> <span class="o">=</span> <span class="s1">'São Paulo'</span>
<span class="n">city</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf_8'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'S\xc3\xa3o Paulo'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">city</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf_16'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'\xff\xfeS\x00\xe3\x00o\x00 \x00P\x00a\x00u\x00l\x00o\x00'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">city</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'cp437'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>

<span class="ansi-red-fg">UnicodeEncodeError</span>Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-4-064a572fd5b6&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>city<span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'cp437'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/lib/python3.8/encodings/cp437.py</span> in <span class="ansi-cyan-fg">encode</span><span class="ansi-blue-fg">(self, input, errors)</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span> 
<span class="ansi-green-intense-fg ansi-bold">     11</span>     <span class="ansi-green-fg">def</span> encode<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>input<span class="ansi-blue-fg">,</span>errors<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">'strict'</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 12</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> codecs<span class="ansi-blue-fg">.</span>charmap_encode<span class="ansi-blue-fg">(</span>input<span class="ansi-blue-fg">,</span>errors<span class="ansi-blue-fg">,</span>encoding_map<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> 
<span class="ansi-green-intense-fg ansi-bold">     14</span>     <span class="ansi-green-fg">def</span> decode<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>input<span class="ansi-blue-fg">,</span>errors<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">'strict'</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">UnicodeEncodeError</span>: 'charmap' codec can't encode character '\xe3' in position 1: character maps to &lt;undefined&gt;</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>error</code> argument however gives you options on how to handle these errors.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">city</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'cp437'</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">'ignore'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'So Paulo'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">city</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'cp437'</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">'replace'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'S?o Paulo'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">city</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'cp437'</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">'xmlcharrefreplace'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'S&amp;#227;o Paulo'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="UnicodeDecodeError">
<a class="anchor" href="#UnicodeDecodeError" aria-hidden="true"><span class="octicon octicon-link"></span></a>UnicodeDecodeError<a class="anchor-link" href="#UnicodeDecodeError"> </a>
</h4>
<p>Not every byte holds a valid ASCII char and not every byte sequence is a valid UTF-8 so if you assume a perticular encoding while converting a binary sequence to text you will get a <code>UnicodeDecodeError</code> if unexpected bytes are encountered.</p>
<p>But some leagacy enodings like <code>cp1252</code> are able to decode any stream of bytes and hence no errors are generated even though the output might be junk.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">octets</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">'Montr</span><span class="se">\xe9</span><span class="s1">al'</span>
<span class="n">octets</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'cp1252'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'Montréal'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">octets</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'iso8859_7'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'Montrιal'</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">octets</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf_8'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>

<span class="ansi-red-fg">UnicodeDecodeError</span>Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-10-afaa3d3916c5&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>octets<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'utf_8'</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">UnicodeDecodeError</span>: 'utf-8' codec can't decode byte 0xe9 in position 5: invalid continuation byte</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">octets</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf_8'</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">'replace'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'Montr�al'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SyntaxError-when-loading-Modules-with-Unexpected-Encodings">
<a class="anchor" href="#SyntaxError-when-loading-Modules-with-Unexpected-Encodings" aria-hidden="true"><span class="octicon octicon-link"></span></a>SyntaxError when loading Modules with Unexpected Encodings<a class="anchor-link" href="#SyntaxError-when-loading-Modules-with-Unexpected-Encodings"> </a>
</h3>
<p>UTF-8 is the default encoding of Python 3 and if your code contains anything else and there is no encoding declaration it will throw an error.
You can use the <code>coding</code> command to provide the expected encoding of the module.</p>

<pre><code># coding: cp1252
print('Olá, Mundo!')</code></pre>
<p>Now coming to whether we should use non-ASCII identifier in source code is a personal choice. Preference should be given to people who is most likely to read and write the codebase more often and you should optimize for that.</p>
<h3 id="How-to-Discover-the-Encoding-of-a-Byte-Sequence">
<a class="anchor" href="#How-to-Discover-the-Encoding-of-a-Byte-Sequence" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to Discover the Encoding of a Byte Sequence<a class="anchor-link" href="#How-to-Discover-the-Encoding-of-a-Byte-Sequence"> </a>
</h3>
<p>in short, you can't, you have to be told. There are tools like <code>Chardet - The Universal Charater Encoding Detector</code> that works to detect the encoding with some assumptions.</p>
<h3 id="BOM:-A-Useful-Gremlin">
<a class="anchor" href="#BOM:-A-Useful-Gremlin" aria-hidden="true"><span class="octicon octicon-link"></span></a>BOM: A Useful Gremlin<a class="anchor-link" href="#BOM:-A-Useful-Gremlin"> </a>
</h3>
<p>You may notice an couple of extra bytes at the beginning of UTF-16 encoded sequence. The bytes '\xff\xfe' are used to denote little endian/big endian.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">u16</span> <span class="o">=</span> <span class="s1">'El Niño'</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf_16'</span><span class="p">)</span>
<span class="n">u16</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>b'\xff\xfeE\x00l\x00 \x00N\x00i\x00\xf1\x00o\x00'</pre>
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/2021/09/08/ch4-text-vs-bytes.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My notes from the best book for intermediate python.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/jjmachan" title="jjmachan"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/jjmachan" title="jjmachan"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
